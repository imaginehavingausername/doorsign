<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Door Sign</title>
  <style id="dynamic-style"></style>
</head>
<body>
  <div id="content">Loading...</div>

  <script>
    let countdownInterval;

    async function loadHTML() {
      try {
        let res = await fetch('message.html?time=' + Date.now(), {cache: "no-store"});
        let html = await res.text();
        document.getElementById('content').innerHTML = html;

        // Wait until next browser paint so new elements exist
        requestAnimationFrame(() => startCountdown());

      } catch(e) {
        console.error("HTML fetch failed:", e);
      }
    }

    async function loadCSS() {
      try {
        let res = await fetch('style.css?time=' + Date.now(), {cache: "no-store"});
        let css = await res.text();
        document.getElementById('dynamic-style').textContent = css;
      } catch(e) {
        console.error("CSS fetch failed:", e);
      }
    }

    function startCountdown() {
      if (countdownInterval) clearInterval(countdownInterval);

      const daysEl = document.getElementById('days');
      const hoursEl = document.getElementById('hours');
      const minutesEl = document.getElementById('minutes');
      const secondsEl = document.getElementById('seconds');

      if (!daysEl || !hoursEl || !minutesEl || !secondsEl) {
        console.error("Countdown elements not found. Timer will not start.");
        return;
      }

      const update = () => {
        const now = new Date();
        let christmasDate = new Date(`December 25, ${now.getFullYear()} 00:00:00`);
        if (now > christmasDate) {
          christmasDate = new Date(`December 25, ${now.getFullYear() + 1} 00:00:00`);
        }

        const totalSeconds = Math.floor((christmasDate - now) / 1000);

        const days = Math.floor(totalSeconds / 86400);
        const hours = Math.floor((totalSeconds % 86400) / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;

        daysEl.innerText = days;
        hoursEl.innerText = String(hours).padStart(2, '0');
        minutesEl.innerText = String(minutes).padStart(2, '0');
        secondsEl.innerText = String(seconds).padStart(2, '0');
      };

      update();
      countdownInterval = setInterval(update, 1000);
    }

    loadHTML();
    loadCSS();

    setInterval(loadHTML, 10000);
    setInterval(loadCSS, 10000);
  </script>
</body>
</html>
