<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Door Sign</title>
  <!-- The CSS will be loaded dynamically into this style tag -->
  <style id="dynamic-style"></style>
</head>
<body>
  <!-- The content from message.html will be loaded here -->
  <div id="content">Loading...</div>

  <script>
    let countdownInterval;

    async function loadHTML() {
      try {
        let res = await fetch('message.html?time=' + Date.now(), {cache: "no-store"});
        let html = await res.text();
        document.getElementById('content').innerHTML = html;
        
        // --- CHANGE ---
        // We use a tiny timeout. This ensures the browser has fully processed the new HTML 
        // before we ask our script to find the countdown elements and start the timer.
        // This prevents a "race condition" and is likely the fix for the timer being stuck.
        setTimeout(startCountdown, 0);

      } catch(e) {
        console.error("HTML fetch failed:", e);
      }
    }

    async function loadCSS() {
      try {
        let res = await fetch('style.css?time=' + Date.now(), {cache: "no-store"});
        let css = await res.text();
        document.getElementById('dynamic-style').textContent = css;
      } catch(e) {
        console.error("CSS fetch failed:", e);
      }
    }

    function startCountdown() {
      if (countdownInterval) {
        clearInterval(countdownInterval);
      }

      const countdown = () => {
        const now = new Date();
        let christmasYear = now.getFullYear();
        let christmasDate = new Date(`December 25, ${christmasYear} 00:00:00`);

        if (now > christmasDate) {
          christmasDate = new Date(`December 25, ${christmasYear + 1} 00:00:00`);
        }

        const totalSeconds = (christmasDate - now) / 1000;

        const days = Math.floor(totalSeconds / 3600 / 24);
        const hours = Math.floor(totalSeconds / 3600) % 24;
        const minutes = Math.floor(totalSeconds / 60) % 60;
        const seconds = Math.floor(totalSeconds) % 60;

        const daysEl = document.getElementById('days');
        const hoursEl = document.getElementById('hours');
        const minutesEl = document.getElementById('minutes');
        const secondsEl = document.getElementById('seconds');

        if (daysEl && hoursEl && minutesEl && secondsEl) {
          daysEl.innerText = days;
          hoursEl.innerText = String(hours).padStart(2, '0');
          minutesEl.innerText = String(minutes).padStart(2, '0');
          secondsEl.innerText = String(seconds).padStart(2, '0');
        } else {
            clearInterval(countdownInterval);
        }
      };
      
      countdown();
      countdownInterval = setInterval(countdown, 1000);
    }

    // Initial load
    loadHTML();
    loadCSS();

    // Refresh every 10 seconds
    setInterval(loadHTML, 10000);
    setInterval(loadCSS, 10000);
  </script>
</body>
</html>

